---
import Checkbox from '../ui/Checkbox.astro'
import InputText from '../ui/InputText.astro'
import Select from '../ui/Select.astro'

// REDCap form fields generated from fields.csv
---

<form class="mx-auto max-w-4xl space-y-6 p-6">
  <!-- Record Information -->
  <div class="space-y-4">
    <input type="hidden" name="record_id" id="record_id" />
    <input type="hidden" name="record_date" id="record_date" />
  </div>

  <!-- Service Type -->
  <div class="space-y-3">
    <label class="block text-sm font-medium text-gray-700">
      What type of support are you looking for from CHI? *
    </label>
    <div class="space-y-2">
      <Checkbox name="service_type[]" value="user" label="New REDCap user account" />
      <Checkbox
        name="service_type[]"
        value="proj"
        label="New service, project, or support request"
      />
      <Checkbox
        name="service_type[]"
        value="trial"
        label="Free trial / practice project"
      />
      <Checkbox
        name="service_type[]"
        value="oth"
        label="Other / learn more about CHI services"
      />
    </div>
  </div>

  <!-- Requester Information -->
  <fieldset class="space-y-4 rounded-lg border border-gray-200 p-4">
    <legend class="px-2 text-lg font-semibold text-gray-900">Requester Information</legend
    >

    <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
      <InputText
        id="requester_fname"
        name="requester_fname"
        label="First Name *"
        required
      />
      <InputText
        id="requester_lname"
        name="requester_lname"
        label="Last Name *"
        required
      />
    </div>

    <div>
      <label for="requester_email" class="block text-sm font-medium text-gray-700"
        >Email *</label
      >
      <input
        type="email"
        name="requester_email"
        id="requester_email"
        required
        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"
      />
    </div>

    <Select
      id="requester_institution"
      name="requester_institution"
      label="Institutional Affiliation *"
      required
      options={[
        { value: '', label: 'Select institution...' },
        { value: 'uc', label: 'University of Calgary' },
        { value: 'oth', label: 'Other (AHS, University of Alberta, etc.)' },
      ]}
    />

    <div id="requester_institution_uc_section" style="display: none;">
      <Select
        id="requester_institution_uc"
        name="requester_institution_uc"
        label="University of Calgary Faculty"
        options={[
          { value: '', label: 'Select faculty...' },
          { value: 'med', label: 'Cumming School of Medicine' },
          { value: 'nur', label: 'Nursing' },
          { value: 'kin', label: 'Kinesiology' },
          { value: 'eng', label: 'Engineering' },
        ]}
      />
    </div>

    <div id="requester_institution_uc_faculty_section">
      <Select
        id="requester_institution_uc_faculty"
        name="requester_institution_uc_faculty"
        label="Department"
        options={[
          { value: '', label: 'Select department...' },
          { value: 'appm', label: 'Anesthesiology, Perioperative and Pain Medicine' },
          { value: 'bmb', label: 'Biochemistry and Molecular Biology' },
          { value: 'cardiac', label: 'Cardiac Sciences' },
          { value: 'cba', label: 'Cell Biology and Anatomy' },
          { value: 'cns', label: 'Clinical Neurosciences' },
          { value: 'chs', label: 'Community Health Sciences' },
          { value: 'ccm', label: 'Critical Care Medicine' },
          { value: 'emerg', label: 'Emergency Medicine' },
          { value: 'fam', label: 'Family Medicine' },
          { value: 'gen', label: 'Medical Genetics' },
          { value: 'med', label: 'Medicine' },
          {
            value: 'microinfect',
            label: 'Microbiology, Immunology and Infectious Diseases',
          },
          { value: 'obgyn', label: 'Obstetrics and Gynaecology' },
          { value: 'onc', label: 'Oncology' },
          { value: 'ped', label: 'Pediatrics / Paediatrics' },
          { value: 'lab', label: 'Pathology and Laboratory Medicine' },
          { value: 'phys', label: 'Physiology and Pharmacology' },
          { value: 'psych', label: 'Psychiatry' },
          { value: 'rad', label: 'Radiology' },
          { value: 'surg', label: 'Surgery' },
        ]}
      />
    </div>

    <div id="requester_institution_oth_section" style="display: none;">
      <Select
        id="requester_institution_oth"
        name="requester_institution_oth"
        label="Other Institution"
        options={[
          { value: '', label: 'Select other...' },
          { value: 'uni', label: 'Other Post-Secondary Institute' },
          { value: 'pca', label: 'Primary Care Alberta' },
          { value: 'aca', label: 'Acute Care Alberta' },
          { value: 'ra', label: 'Recovery Alberta' },
          { value: 'ala', label: 'Assisted Living Alberta' },
          { value: 'ahs', label: 'Alberta Health Services' },
          { value: 'oth', label: 'Other' },
        ]}
      />
    </div>

    <div id="requester_institution_uni_section" style="display: none;">
      <InputText
        id="requester_institution_uni"
        name="requester_institution_uni"
        label="Specify Institution"
        placeholder="specify institution"
      />
    </div>

    <div id="requester_institution_other_section" style="display: none;">
      <InputText
        id="requester_institution_other"
        name="requester_institution_other"
        label="Other Institution"
        placeholder="specify institution"
      />
    </div>

    <div>
      <InputText
        id="requester_referred_from"
        name="requester_referred_from"
        label="How did you hear about our services?"
      />
    </div>
  </fieldset>

  <!-- New REDCap User Account Section -->
  <fieldset
    class="space-y-4 rounded-lg border border-gray-200 p-4"
    id="user_section"
    style="display: none;"
  >
    <legend class="px-2 text-lg font-semibold text-gray-900"
      >New REDCap User Account</legend
    >

    <div>
      <Select
        id="user_account_num"
        name="user_account_num"
        label="How many new user accounts are you requesting?"
        options={[
          { value: '1', label: '1' },
          { value: '2', label: '2' },
          { value: '3', label: '3' },
          { value: '4', label: '4' },
          { value: '5', label: '5' },
          { value: '6', label: '6' },
          { value: '7', label: '7' },
          { value: '8', label: '8' },
          { value: '9', label: '9' },
          { value: '10', label: '10' },
          { value: '11', label: '11' },
          { value: '12', label: '12' },
          { value: '13', label: '13' },
          { value: '14', label: '14' },
          { value: '15', label: '15' },
        ]}
      />
    </div>

    <div>
      <Checkbox name="user_1_is_requester" value="1" label="This account is for myself" />
    </div>

    <div class="grid grid-cols-1 gap-4 md:grid-cols-3" id="user_1_fields">
      <InputText id="user_1_fname" name="user_1_fname" label="User 1 First Name" />
      <InputText id="user_1_lname" name="user_1_lname" label="User 1 Last Name" />
      <div>
        <label for="user_1_email" class="block text-sm font-medium text-gray-700"
          >User 1 Email</label
        >
        <input
          type="email"
          name="user_1_email"
          id="user_1_email"
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"
        />
      </div>
    </div>

    <!-- Additional user fields (2-15) would be generated dynamically -->
    <div id="additional_users">
      <!-- Users 2-15 will be added via JavaScript based on user_account_num selection -->
    </div>

    <div>
      <Checkbox
        name="user_notify"
        value="1"
        label="I would like to be notified when the requested account(s) are created & their usernames"
      />
    </div>
  </fieldset>

  <!-- Project Information Section -->
  <fieldset
    class="space-y-4 rounded-lg border border-gray-200 p-4"
    id="project_section"
    style="display: none;"
  >
    <legend class="px-2 text-lg font-semibold text-gray-900"
      >New Service or Project</legend
    >

    <div class="space-y-3">
      <label class="block text-sm font-medium text-gray-700"
        >What type of support or service do you need? *</label
      >
      <div class="space-y-2">
        <Checkbox
          name="proj_type[]"
          value="rc"
          label="REDCap (Research Electronic Data Capture)"
        />
        <Checkbox name="proj_type[]" value="custom" label="Custom Platform Development" />
        <Checkbox
          name="proj_type[]"
          value="ma"
          label="Methods, Data & Analytics Support"
        />
      </div>
    </div>

    <div>
      <InputText
        id="proj_title"
        name="proj_title"
        label="Project or Study Title *"
        required
      />
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700"
        >Purpose of your project or study? *</label
      >
      <div class="mt-2 space-y-2">
        <label class="flex items-center">
          <input
            type="radio"
            name="proj_purpose"
            value="research"
            class="border-gray-300"
          />
          <span class="ml-2">Research</span>
        </label>
        <label class="flex items-center">
          <input type="radio" name="proj_purpose" value="qi" class="border-gray-300" />
          <span class="ml-2">Quality Improvement</span>
        </label>
        <label class="flex items-center">
          <input type="radio" name="proj_purpose" value="op" class="border-gray-300" />
          <span class="ml-2">Operational</span>
        </label>
      </div>
    </div>

    <!-- Research Purpose Sub-options -->
    <div id="research_purpose_section" style="display: none;">
      <label class="block text-sm font-medium text-gray-700">Research Type</label>
      <div class="mt-2 space-y-2">
        <label class="flex items-center">
          <input
            type="radio"
            name="proj_purpose_res"
            value="basic"
            class="border-gray-300"
          />
          <span class="ml-2">Basic research</span>
        </label>
        <label class="flex items-center">
          <input
            type="radio"
            name="proj_purpose_res"
            value="ct"
            class="border-gray-300"
          />
          <span class="ml-2">Clinical Trial</span>
        </label>
        <label class="flex items-center">
          <input
            type="radio"
            name="proj_purpose_res"
            value="registry"
            class="border-gray-300"
          />
          <span class="ml-2">Registry/Repository</span>
        </label>
        <label class="flex items-center">
          <input
            type="radio"
            name="proj_purpose_res"
            value="oth"
            class="border-gray-300"
          />
          <span class="ml-2">Other</span>
        </label>
      </div>
    </div>

    <div id="research_other_section" style="display: none;">
      <InputText
        id="proj_purpose_res_oth"
        name="proj_purpose_res_oth"
        label="Specify Research Purpose"
        placeholder="specify project or study purpose"
      />
    </div>

    <!-- Principal Investigator Information -->
    <fieldset class="space-y-4 rounded border border-gray-100 p-3">
      <legend class="text-md px-2 font-medium text-gray-800"
        >Principal Investigator Information</legend
      >

      <div>
        <Checkbox
          name="proj_requester_is_pi"
          value="1"
          label="I am the principal investigator"
        />
      </div>

      <div class="grid grid-cols-1 gap-4 md:grid-cols-3" id="pi_fields">
        <InputText id="proj_pi_fname" name="proj_pi_fname" label="PI First Name" />
        <InputText id="proj_pi_lname" name="proj_pi_lname" label="PI Last Name" />
        <div>
          <label for="proj_pi_email" class="block text-sm font-medium text-gray-700"
            >PI Email</label
          >
          <input
            type="email"
            name="proj_pi_email"
            id="proj_pi_email"
            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"
          />
        </div>
      </div>
    </fieldset>

    <!-- Project Details -->
    <div class="space-y-4">
      <div>
        <Checkbox
          name="proj_is_lshi"
          value="1"
          label="This study is a Learning Health System Initiative (LSHI)"
        />
      </div>

      <div>
        <Checkbox
          name="proj_have_protocol"
          value="1"
          label="I have a study or project summary/protocol I can upload"
        />
      </div>

      <div id="protocol_upload_section" style="display: none;">
        <label for="proj_protocol_upload" class="block text-sm font-medium text-gray-700"
          >Project Summary/Protocol Upload</label
        >
        <input
          type="file"
          name="proj_protocol_upload"
          id="proj_protocol_upload"
          class="mt-1 block w-full"
        />
      </div>

      <div>
        <Checkbox name="proj_have_ethics" value="1" label="I have ethics approval" />
      </div>

      <div id="ethics_details_section" style="display: none;">
        <div>
          <InputText
            id="proj_ethics_id"
            name="proj_ethics_id"
            label="Ethics ID"
            placeholder="Ethics ID"
          />
        </div>
        <div>
          <label for="proj_ethics_upload" class="block text-sm font-medium text-gray-700"
            >Ethics Upload</label
          >
          <input
            type="file"
            name="proj_ethics_upload"
            id="proj_ethics_upload"
            class="mt-1 block w-full"
          />
        </div>
      </div>

      <div>
        <Checkbox name="proj_need_ethics" value="1" label="I need support with ethics" />
      </div>

      <div>
        <Checkbox
          name="proj_have_budget"
          value="1"
          label="I have an approved/anticipated budget in mind"
        />
      </div>

      <div id="budget_section" style="display: none;">
        <label for="proj_budget_amt" class="block text-sm font-medium text-gray-700"
          >Budget Amount (CAD$)</label
        >
        <input
          type="number"
          name="proj_budget_amt"
          id="proj_budget_amt"
          placeholder="CAD$"
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"
        />
      </div>

      <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
        <div>
          <label for="proj_date_start" class="block text-sm font-medium text-gray-700"
            >Intended Start Date</label
          >
          <input
            type="date"
            name="proj_date_start"
            id="proj_date_start"
            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"
          />
        </div>
        <div>
          <label for="proj_date_end" class="block text-sm font-medium text-gray-700"
            >Intended End Date</label
          >
          <input
            type="date"
            name="proj_date_end"
            id="proj_date_end"
            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"
          />
        </div>
      </div>
    </div>
  </fieldset>

  <!-- REDCap Specific Section -->
  <fieldset
    class="space-y-4 rounded-lg border border-gray-200 p-4"
    id="redcap_section"
    style="display: none;"
  >
    <legend class="px-2 text-lg font-semibold text-gray-900"
      >REDCap Project Details</legend
    >

    <div>
      <label class="block text-sm font-medium text-gray-700"
        >What type of project service are you interested in?</label
      >
      <div class="mt-2 space-y-2">
        <label class="flex items-center">
          <input type="radio" name="rc_build" value="self" class="border-gray-300" />
          <span class="ml-2">Self-service project</span>
        </label>
        <label class="flex items-center">
          <input type="radio" name="rc_build" value="chi" class="border-gray-300" />
          <span class="ml-2">CHI supported project</span>
        </label>
      </div>
      <label class="mt-2 flex items-center">
        <Checkbox name="rc_build_unsure" value="1" label="I am unsure" />
      </label>
    </div>

    <div>
      <label for="rc_participant_num" class="block text-sm font-medium text-gray-700"
        >Number of Expected Study Participants</label
      >
      <input
        type="number"
        name="rc_participant_num"
        id="rc_participant_num"
        min="0"
        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"
      />
    </div>

    <div>
      <label for="rc_site_num" class="block text-sm font-medium text-gray-700"
        >Number of Study Sites</label
      >
      <input
        type="number"
        name="rc_site_num"
        id="rc_site_num"
        min="0"
        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"
      />
    </div>

    <div>
      <Checkbox
        name="rc_have_international_sites"
        value="1"
        label="I have international sites"
      />
    </div>

    <div id="international_sites_section" style="display: none;">
      <label class="block text-sm font-medium text-gray-700"
        >Which international sites?</label
      >
      <div class="mt-2 space-y-2">
        <label class="flex items-center">
          <input
            type="checkbox"
            name="rc_international_sites[]"
            value="usa"
            class="rounded border-gray-300"
          />
          <span class="ml-2">USA</span>
        </label>
        <label class="flex items-center">
          <input
            type="checkbox"
            name="rc_international_sites[]"
            value="europe"
            class="rounded border-gray-300"
          />
          <span class="ml-2">Europe</span>
        </label>
        <label class="flex items-center">
          <input
            type="checkbox"
            name="rc_international_sites[]"
            value="oth"
            class="rounded border-gray-300"
          />
          <span class="ml-2">Other</span>
        </label>
      </div>
    </div>

    <div>
      <Checkbox
        name="rc_have_surveys"
        value="1"
        label="I require surveys (online questionnaires) to be sent to participants"
      />
    </div>

    <div>
      <Checkbox name="rc_have_randomization" value="1" label="I require randomization" />
    </div>

    <div id="randomization_section" style="display: none;">
      <label
        for="rc_randomization_summary"
        class="block text-sm font-medium text-gray-700"
        >Please provide a summary of the randomization schema</label
      >
      <textarea
        name="rc_randomization_summary"
        id="rc_randomization_summary"
        rows="3"
        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></textarea>
    </div>

    <div>
      <Checkbox
        name="rc_have_xml"
        value="1"
        label="I have an existing REDCap project XML file to create my project from"
      />
    </div>

    <div id="xml_upload_section" style="display: none;">
      <label for="rc_xml_upload" class="block text-sm font-medium text-gray-700"
        >Existing REDCap Project XML File</label
      >
      <input
        type="file"
        name="rc_xml_upload"
        id="rc_xml_upload"
        accept=".xml"
        class="mt-1 block w-full"
      />
    </div>

    <!-- REDCap Pricing Tier -->
    <div>
      <label class="block text-sm font-medium text-gray-700"
        >Please select a REDCap Support Tier *</label
      >
      <p class="mb-2 text-sm text-gray-600">
        <a
          href="https://cru.ucalgary.ca/data-capture/pricing/"
          class="text-blue-600 hover:underline"
          >See Data Capture Pricing for more information</a
        >
      </p>
      <div class="space-y-2">
        <label class="flex items-center">
          <input
            type="radio"
            name="rc_price_tier"
            value="basic"
            class="border-gray-300"
          />
          <span class="ml-2">Basic</span>
        </label>
        <label class="flex items-center">
          <input type="radio" name="rc_price_tier" value="plus" class="border-gray-300" />
          <span class="ml-2">Plus</span>
        </label>
        <label class="flex items-center">
          <input
            type="radio"
            name="rc_price_tier"
            value="premium"
            class="border-gray-300"
          />
          <span class="ml-2">Premium</span>
        </label>
      </div>
    </div>
  </fieldset>

  <!-- Methods & Analytics Section -->
  <fieldset
    class="space-y-4 rounded-lg border border-gray-200 p-4"
    id="methods_analytics_section"
    style="display: none;"
  >
    <legend class="px-2 text-lg font-semibold text-gray-900"
      >Methods, Data & Analytics Support</legend
    >

    <div>
      <label class="block text-sm font-medium text-gray-700"
        >Do you currently have data? *</label
      >
      <div class="mt-2 space-y-2">
        <label class="flex items-center">
          <input
            type="radio"
            name="ma_have_existing_data"
            value="1"
            class="border-gray-300"
          />
          <span class="ml-2">Yes</span>
        </label>
        <label class="flex items-center">
          <input
            type="radio"
            name="ma_have_existing_data"
            value="0"
            class="border-gray-300"
          />
          <span class="ml-2">No, I require data access</span>
        </label>
        <label class="flex items-center">
          <input
            type="radio"
            name="ma_have_existing_data"
            value="99"
            class="border-gray-300"
          />
          <span class="ml-2">I am looking for more information</span>
        </label>
      </div>
    </div>

    <div id="existing_data_section" style="display: none;">
      <label class="block text-sm font-medium text-gray-700"
        >What type of data do you have?</label
      >
      <div class="mt-2 space-y-2">
        <label class="flex items-center">
          <input
            type="checkbox"
            name="ma_existing_data[]"
            value="rc"
            class="rounded border-gray-300"
          />
          <span class="ml-2">I have data on CHI's REDCap platform</span>
        </label>
        <label class="flex items-center">
          <input
            type="checkbox"
            name="ma_existing_data[]"
            value="admin"
            class="rounded border-gray-300"
          />
          <span class="ml-2">I have administrative data</span>
        </label>
        <label class="flex items-center">
          <input
            type="checkbox"
            name="ma_existing_data[]"
            value="oth"
            class="rounded border-gray-300"
          />
          <span class="ml-2">I have other data</span>
        </label>
      </div>
    </div>

    <div id="redcap_pid_section" style="display: none;">
      <label for="ma_existing_data_pid" class="block text-sm font-medium text-gray-700"
        >REDCap PID</label
      >
      <input
        type="number"
        name="ma_existing_data_pid"
        id="ma_existing_data_pid"
        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"
      />
    </div>

    <div id="dataset_description_section" style="display: none;">
      <label for="ma_data_desc" class="block text-sm font-medium text-gray-700"
        >What dataset(s) will you be using?</label
      >
      <textarea
        name="ma_data_desc"
        id="ma_data_desc"
        rows="3"
        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></textarea>
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700"
        >What Methods support do you require? *</label
      >
      <div class="mt-2 space-y-2">
        <label class="flex items-center">
          <input
            type="checkbox"
            name="ma_methods[]"
            value="power"
            class="rounded border-gray-300"
          />
          <span class="ml-2">Power/sample size calculations</span>
        </label>
        <label class="flex items-center">
          <input
            type="checkbox"
            name="ma_methods[]"
            value="review"
            class="rounded border-gray-300"
          />
          <span class="ml-2"
            >Review of existing methods section/research design/statistical plan</span
          >
        </label>
        <label class="flex items-center">
          <input
            type="checkbox"
            name="ma_methods[]"
            value="dev"
            class="rounded border-gray-300"
          />
          <span class="ml-2"
            >Co-development of methods section/research design/statistical plan</span
          >
        </label>
        <label class="flex items-center">
          <input
            type="checkbox"
            name="ma_methods[]"
            value="unsure"
            class="rounded border-gray-300"
          />
          <span class="ml-2">I am unsure</span>
        </label>
        <label class="flex items-center">
          <input
            type="checkbox"
            name="ma_methods[]"
            value="none"
            class="rounded border-gray-300"
          />
          <span class="ml-2">I don't require methods support</span>
        </label>
      </div>
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700"
        >What Analytics support do you require? *</label
      >
      <div class="mt-2 space-y-2">
        <label class="flex items-center">
          <input
            type="checkbox"
            name="ma_analytics[]"
            value="cleaning"
            class="rounded border-gray-300"
          />
          <span class="ml-2">Data cleaning, linking and processing</span>
        </label>
        <label class="flex items-center">
          <input
            type="checkbox"
            name="ma_analytics[]"
            value="power"
            class="rounded border-gray-300"
          />
          <span class="ml-2">Sample size calculation (a priori power calculations)</span>
        </label>
        <label class="flex items-center">
          <input
            type="checkbox"
            name="ma_analytics[]"
            value="stats"
            class="rounded border-gray-300"
          />
          <span class="ml-2"
            >Descriptive statistics, traditional biostatistical methods</span
          >
        </label>
        <label class="flex items-center">
          <input
            type="checkbox"
            name="ma_analytics[]"
            value="ml"
            class="rounded border-gray-300"
          />
          <span class="ml-2">Machine learning and data science methods</span>
        </label>
        <label class="flex items-center">
          <input
            type="checkbox"
            name="ma_analytics[]"
            value="vis"
            class="rounded border-gray-300"
          />
          <span class="ml-2">Visualizations</span>
        </label>
        <label class="flex items-center">
          <input
            type="checkbox"
            name="ma_analytics[]"
            value="oth"
            class="rounded border-gray-300"
          />
          <span class="ml-2">Other</span>
        </label>
        <label class="flex items-center">
          <input
            type="checkbox"
            name="ma_analytics[]"
            value="unsure"
            class="rounded border-gray-300"
          />
          <span class="ml-2">I am unsure</span>
        </label>
        <label class="flex items-center">
          <input
            type="checkbox"
            name="ma_analytics[]"
            value="none"
            class="rounded border-gray-300"
          />
          <span class="ml-2">I don't require analytics support</span>
        </label>
      </div>
    </div>

    <div id="analytics_other_section" style="display: none;">
      <label for="ma_analytics_oth" class="block text-sm font-medium text-gray-700"
        >What other Analytics support do you require?</label
      >
      <textarea
        name="ma_analytics_oth"
        id="ma_analytics_oth"
        rows="3"
        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></textarea>
    </div>

    <div>
      <InputText
        id="ma_research_question"
        name="ma_research_question"
        label="What is your Research Question?"
      />
    </div>
  </fieldset>

  <!-- Custom Platform Development Section -->
  <fieldset
    class="space-y-4 rounded-lg border border-gray-200 p-4"
    id="custom_section"
    style="display: none;"
  >
    <legend class="px-2 text-lg font-semibold text-gray-900"
      >Custom Platform Development</legend
    >

    <div>
      <label class="block text-sm font-medium text-gray-700"
        >What type of Custom Data Services do you need? *</label
      >
      <div class="mt-2 space-y-2">
        <label class="flex items-center">
          <input
            type="checkbox"
            name="custom_type[]"
            value="dashboard"
            class="rounded border-gray-300"
          />
          <span class="ml-2">Data Dashboards</span>
        </label>
        <label class="flex items-center">
          <input
            type="checkbox"
            name="custom_type[]"
            value="web"
            class="rounded border-gray-300"
          />
          <span class="ml-2">Public Facing Websites</span>
        </label>
        <label class="flex items-center">
          <input
            type="checkbox"
            name="custom_type[]"
            value="edc"
            class="rounded border-gray-300"
          />
          <span class="ml-2">Custom Data Capture Application</span>
        </label>
        <label class="flex items-center">
          <input
            type="checkbox"
            name="custom_type[]"
            value="mgmt"
            class="rounded border-gray-300"
          />
          <span class="ml-2">Data Management Tool</span>
        </label>
        <label class="flex items-center">
          <input
            type="checkbox"
            name="custom_type[]"
            value="infra"
            class="rounded border-gray-300"
          />
          <span class="ml-2">Infrastructure</span>
        </label>
        <label class="flex items-center">
          <input
            type="checkbox"
            name="custom_type[]"
            value="advice"
            class="rounded border-gray-300"
          />
          <span class="ml-2">Advisory/Consultancy</span>
        </label>
        <label class="flex items-center">
          <input
            type="checkbox"
            name="custom_type[]"
            value="mobile"
            class="rounded border-gray-300"
          />
          <span class="ml-2">Mobile Data Capture Tool</span>
        </label>
        <label class="flex items-center">
          <input
            type="checkbox"
            name="custom_type[]"
            value="unsure"
            class="rounded border-gray-300"
          />
          <span class="ml-2">I'm unsure</span>
        </label>
      </div>
    </div>

    <div>
      <label for="custom_needs" class="block text-sm font-medium text-gray-700"
        >Please elaborate on your needs or vision? *</label
      >
      <textarea
        name="custom_needs"
        id="custom_needs"
        rows="4"
        required
        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></textarea>
    </div>

    <div>
      <Checkbox
        name="custom_need_rc"
        value="1"
        label="I require any custom integration with REDCap or other platforms"
      />
    </div>

    <div id="custom_integration_section" style="display: none;">
      <label for="custom_rc_summary" class="block text-sm font-medium text-gray-700"
        >Please describe your integration needs</label
      >
      <textarea
        name="custom_rc_summary"
        id="custom_rc_summary"
        rows="3"
        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></textarea>
    </div>
  </fieldset>

  <!-- Free Trial Section -->
  <fieldset
    class="space-y-4 rounded-lg border border-gray-200 p-4"
    id="trial_section"
    style="display: none;"
  >
    <legend class="px-2 text-lg font-semibold text-gray-900"
      >Free Trial / Practice Project</legend
    >

    <div>
      <label class="block text-sm font-medium text-gray-700"
        >What type of service are you looking to try? *</label
      >
      <div class="mt-2 space-y-2">
        <label class="flex items-center">
          <input
            type="checkbox"
            name="trial_type[]"
            value="rc"
            class="rounded border-gray-300"
          />
          <span class="ml-2">REDCap practice/training project</span>
        </label>
        <label class="flex items-center">
          <input
            type="checkbox"
            name="trial_type[]"
            value="dx"
            class="rounded border-gray-300"
          />
          <span class="ml-2">DataXplor</span>
        </label>
      </div>
    </div>

    <div id="trial_redcap_section" style="display: none;">
      <div>
        <InputText
          id="trial_proj_title"
          name="trial_proj_title"
          label="Practice Project Title *"
        />
      </div>

      <div>
        <label for="trial_rc_users" class="block text-sm font-medium text-gray-700"
          >REDCap Username(s) to add to the practice project</label
        >
        <textarea
          name="trial_rc_users"
          id="trial_rc_users"
          rows="3"
          placeholder="Including your own, if known"
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></textarea>
      </div>
    </div>
  </fieldset>

  <!-- Financial Information -->
  <fieldset
    class="space-y-4 rounded-lg border border-gray-200 p-4"
    id="financial_section"
    style="display: none;"
  >
    <legend class="px-2 text-lg font-semibold text-gray-900">Financial Information</legend
    >

    <div>
      <Checkbox
        name="fin_requester_is_contact"
        value="1"
        label="I am the billing contact"
      />
    </div>

    <div class="grid grid-cols-1 gap-4 md:grid-cols-3" id="billing_contact_fields">
      <InputText
        id="fin_contact_fname"
        name="fin_contact_fname"
        label="Billing Contact First Name"
      />
      <InputText
        id="fin_contact_lname"
        name="fin_contact_lname"
        label="Billing Contact Last Name"
      />
      <div>
        <label for="fin_contact_email" class="block text-sm font-medium text-gray-700"
          >Billing Contact Email</label
        >
        <input
          type="email"
          name="fin_contact_email"
          id="fin_contact_email"
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"
        />
      </div>
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700"
        >Please select preferred payment method *</label
      >
      <div class="mt-2 space-y-2">
        <label class="flex items-center">
          <input type="radio" name="fin_method" value="uofc" class="border-gray-300" />
          <span class="ml-2">UofC GLJE/Journal Transfer</span>
        </label>
        <label class="flex items-center">
          <input type="radio" name="fin_method" value="ex" class="border-gray-300" />
          <span class="ml-2">External Account (e.g., AHS, other institutions)</span>
        </label>
        <label class="flex items-center">
          <input type="radio" name="fin_method" value="cc" class="border-gray-300" />
          <span class="ml-2">Credit Card (note: UofC PCard is not allowed)</span>
        </label>
      </div>
    </div>

    <div id="external_payment_section" style="display: none;" class="space-y-4">
      <div>
        <InputText
          id="fin_method_ex_institution"
          name="fin_method_ex_institution"
          label="Institution/Company Name *"
        />
      </div>
      <div>
        <label for="fin_method_ex_address" class="block text-sm font-medium text-gray-700"
          >Institution/Company Address *</label
        >
        <textarea
          name="fin_method_ex_address"
          id="fin_method_ex_address"
          rows="3"
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></textarea>
      </div>
      <div>
        <InputText
          id="fin_method_ex_name"
          name="fin_method_ex_name"
          label="Institution/Company Contact Name *"
        />
      </div>
      <div>
        <label for="fin_method_ex_email" class="block text-sm font-medium text-gray-700"
          >Institution/Company Contact Email *</label
        >
        <input
          type="email"
          name="fin_method_ex_email"
          id="fin_method_ex_email"
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"
        />
      </div>
    </div>

    <div>
      <label class="flex items-center">
        <input
          type="checkbox"
          name="terms_agree"
          value="1"
          required
          class="rounded border-gray-300"
        />
        <span class="ml-2">I agree to the Terms & Conditions *</span>
      </label>
    </div>

    <div>
      <label for="terms_sig" class="block text-sm font-medium text-gray-700"
        >Authorization Signature *</label
      >
      <input
        type="file"
        name="terms_sig"
        id="terms_sig"
        required
        class="mt-1 block w-full"
      />
    </div>
  </fieldset>

  <!-- Other Services Section -->
  <fieldset
    class="space-y-4 rounded-lg border border-gray-200 p-4"
    id="other_section"
    style="display: none;"
  >
    <legend class="px-2 text-lg font-semibold text-gray-900">Other Services</legend>

    <div>
      <label for="service_oth_questions" class="block text-sm font-medium text-gray-700"
        >What would you like help with, or what questions do you have?</label
      >
      <textarea
        name="service_oth_questions"
        id="service_oth_questions"
        rows="4"
        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></textarea>
    </div>
  </fieldset>

  <!-- Additional Comments -->
  <div>
    <label for="service_comments" class="block text-sm font-medium text-gray-700"
      >Any additional notes or comments?</label
    >
    <textarea
      name="service_comments"
      id="service_comments"
      rows="3"
      class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></textarea>
  </div>

  <!-- Submit Button -->
  <div class="pt-6">
    <button
      type="submit"
      class="bg-brand-primary-700 hover:bg-brand-primary-800 focus:ring-brand-primary-500 w-full rounded-md px-4 py-2 text-white focus:ring-2 focus:ring-offset-2"
    >
      Submit Request
    </button>
  </div>

  <script>
    // JavaScript to handle form logic and conditional field display
    document.addEventListener('DOMContentLoaded', function () {
      // Handle service type checkboxes
      const serviceTypeCheckboxes = document.querySelectorAll(
        'input[name="service_type[]"]'
      )
      const userSection = document.getElementById('user_section')
      const projectSection = document.getElementById('project_section')
      const trialSection = document.getElementById('trial_section')
      const otherSection = document.getElementById('other_section')

      serviceTypeCheckboxes.forEach((checkbox) => {
        checkbox.addEventListener('change', function () {
          const checkedValues = Array.from(serviceTypeCheckboxes)
            .filter((cb) => cb.checked)
            .map((cb) => cb.value)

          userSection.style.display = checkedValues.includes('user') ? 'block' : 'none'
          projectSection.style.display = checkedValues.includes('proj') ? 'block' : 'none'
          trialSection.style.display = checkedValues.includes('trial') ? 'block' : 'none'
          otherSection.style.display = checkedValues.includes('oth') ? 'block' : 'none'
        })
      })

      // Handle institutional affiliation logic
      const institutionSelect = document.getElementById('requester_institution')
      const ucSection = document.getElementById('requester_institution_uc_section')
      const ucFacultySection = document.getElementById(
        'requester_institution_uc_faculty_section'
      )
      const othSection = document.getElementById('requester_institution_oth_section')
      const uniSection = document.getElementById('requester_institution_uni_section')
      const otherInstSection = document.getElementById(
        'requester_institution_other_section'
      )

      institutionSelect.addEventListener('change', function () {
        ucSection.style.display = this.value === 'uc' ? 'block' : 'none'
        othSection.style.display = this.value === 'oth' ? 'block' : 'none'
      })

      const ucSelect = document.getElementById('requester_institution_uc')
      ucSelect.addEventListener('change', function () {
        ucFacultySection.style.display = this.value === 'med' ? 'block' : 'none'
      })

      const othSelect = document.getElementById('requester_institution_oth')
      othSelect.addEventListener('change', function () {
        uniSection.style.display = this.value === 'uni' ? 'block' : 'none'
        otherInstSection.style.display = this.value === 'oth' ? 'block' : 'none'
      })

      // Handle project type logic
      const projTypeCheckboxes = document.querySelectorAll('input[name="proj_type[]"]')
      const redcapSection = document.getElementById('redcap_section')
      const methodsAnalyticsSection = document.getElementById('methods_analytics_section')
      const customSection = document.getElementById('custom_section')
      const financialSection = document.getElementById('financial_section')

      projTypeCheckboxes.forEach((checkbox) => {
        checkbox.addEventListener('change', function () {
          const checkedValues = Array.from(projTypeCheckboxes)
            .filter((cb) => cb.checked)
            .map((cb) => cb.value)

          redcapSection.style.display = checkedValues.includes('rc') ? 'block' : 'none'
          methodsAnalyticsSection.style.display = checkedValues.includes('ma')
            ? 'block'
            : 'none'
          customSection.style.display = checkedValues.includes('custom')
            ? 'block'
            : 'none'
          financialSection.style.display = checkedValues.length > 0 ? 'block' : 'none'
        })
      })

      // Handle research purpose logic
      const projPurposeRadios = document.querySelectorAll('input[name="proj_purpose"]')
      const researchPurposeSection = document.getElementById('research_purpose_section')

      projPurposeRadios.forEach((radio) => {
        radio.addEventListener('change', function () {
          researchPurposeSection.style.display =
            this.value === 'research' ? 'block' : 'none'
        })
      })

      const researchTypeRadios = document.querySelectorAll(
        'input[name="proj_purpose_res"]'
      )
      const researchOtherSection = document.getElementById('research_other_section')

      researchTypeRadios.forEach((radio) => {
        radio.addEventListener('change', function () {
          researchOtherSection.style.display = this.value === 'oth' ? 'block' : 'none'
        })
      })

      // Handle PI information logic
      const piCheckbox = document.getElementById('proj_requester_is_pi')
      const piFields = document.getElementById('pi_fields')

      if (piCheckbox) {
        piCheckbox.addEventListener('change', function () {
          const piInputs = piFields.querySelectorAll('input')
          piInputs.forEach((input) => {
            input.style.display = this.checked ? 'none' : 'block'
            input.required = !this.checked
          })
        })
      }

      // Handle other conditional sections
      const conditionalSections = [
        { trigger: 'proj_have_protocol', section: 'protocol_upload_section' },
        { trigger: 'proj_have_ethics', section: 'ethics_details_section' },
        { trigger: 'proj_have_budget', section: 'budget_section' },
        {
          trigger: 'rc_have_international_sites',
          section: 'international_sites_section',
        },
        { trigger: 'rc_have_randomization', section: 'randomization_section' },
        { trigger: 'rc_have_xml', section: 'xml_upload_section' },
        { trigger: 'custom_need_rc', section: 'custom_integration_section' },
        {
          trigger: 'fin_requester_is_contact',
          section: 'billing_contact_fields',
          reverse: true,
        },
      ]

      conditionalSections.forEach(({ trigger, section, reverse = false }) => {
        const triggerElement = document.querySelector(`[name="${trigger}"]`)
        const sectionElement = document.getElementById(section)

        if (triggerElement && sectionElement) {
          triggerElement.addEventListener('change', function () {
            const show = reverse ? !this.checked : this.checked
            sectionElement.style.display = show ? 'block' : 'none'
          })
        }
      })

      // Handle payment method logic
      const paymentRadios = document.querySelectorAll('input[name="fin_method"]')
      const externalPaymentSection = document.getElementById('external_payment_section')

      paymentRadios.forEach((radio) => {
        radio.addEventListener('change', function () {
          externalPaymentSection.style.display = this.value === 'ex' ? 'block' : 'none'
        })
      })

      // Handle trial type logic
      const trialTypeCheckboxes = document.querySelectorAll('input[name="trial_type[]"]')
      const trialRedcapSection = document.getElementById('trial_redcap_section')

      trialTypeCheckboxes.forEach((checkbox) => {
        checkbox.addEventListener('change', function () {
          const checkedValues = Array.from(trialTypeCheckboxes)
            .filter((cb) => cb.checked)
            .map((cb) => cb.value)
          trialRedcapSection.style.display = checkedValues.includes('rc')
            ? 'block'
            : 'none'
        })
      })

      // Handle methods & analytics conditional logic
      const maHaveDataRadios = document.querySelectorAll(
        'input[name="ma_have_existing_data"]'
      )
      const existingDataSection = document.getElementById('existing_data_section')
      const datasetDescSection = document.getElementById('dataset_description_section')

      maHaveDataRadios.forEach((radio) => {
        radio.addEventListener('change', function () {
          existingDataSection.style.display = this.value === '1' ? 'block' : 'none'
          datasetDescSection.style.display =
            this.value === '0' || this.value === '99' ? 'block' : 'none'
        })
      })

      const maExistingDataCheckboxes = document.querySelectorAll(
        'input[name="ma_existing_data[]"]'
      )
      const redcapPidSection = document.getElementById('redcap_pid_section')

      maExistingDataCheckboxes.forEach((checkbox) => {
        checkbox.addEventListener('change', function () {
          const checkedValues = Array.from(maExistingDataCheckboxes)
            .filter((cb) => cb.checked)
            .map((cb) => cb.value)
          redcapPidSection.style.display = checkedValues.includes('rc') ? 'block' : 'none'
        })
      })

      const analyticsOtherCheckbox = document.querySelector(
        'input[name="ma_analytics[]"][value="oth"]'
      )
      const analyticsOtherSection = document.getElementById('analytics_other_section')

      if (analyticsOtherCheckbox) {
        analyticsOtherCheckbox.addEventListener('change', function () {
          analyticsOtherSection.style.display = this.checked ? 'block' : 'none'
        })
      }

      // Set current date for hidden record_date field
      const recordDateField = document.getElementById('record_date')
      if (recordDateField) {
        recordDateField.value = new Date().toISOString().split('T')[0]
      }
    })
  </script>
</form>
